var Journey=new Class({start:0,end:1440,itsGranularity:60,minutesInAnHour:60,initialize:function(b,a){if($defined(b)&&$defined(a)){this.start=this.convertToMinutesDay(b);this.end=this.convertToMinutesDay(a)}},starts:function(){return this.normalize(this.start)},ends:function(){return this.normalize(this.end)},granularity:function(){return this.itsGranularity},withGranularityOf:function(a){this.itsGranularity=parseInt(a)},normalize:function(a){if(isNaN(a)){return undefined}return this.formatHour(a)},convertToMinutesDay:function(b){var e=24;var d=10;var c=0;b=b+"";var f=b.split(":",2);hour=parseInt(f[0],d);if($defined(f[1])){c=parseInt(f[1],d)}if((c>=this.minutesInAnHour)||(c<0)){return null}if((hour>e)||(hour<0)){return null}var a=(hour*this.minutesInAnHour)+c;return a},formatHour:function(c){var d=10;var a=Math.floor(c/this.minutesInAnHour);var c=c%this.minutesInAnHour;var e=c<d?"0"+c:c;var b=a<d?"0"+a:a;return b+":"+e},isValid:function(){return this.start<this.end},slots:function(){theSlots=new Array();index=0;for(var a=this.start;(a+this.itsGranularity)<=this.end;a=a+this.itsGranularity){initialMinute=a;journeyStart=this.formatHour(initialMinute);journeyEnd=this.formatHour(initialMinute+this.itsGranularity);theSlots[index++]=new Journey(journeyStart,journeyEnd)}lastSlot=theSlots[index-1];if(lastSlot.ends()!=this.ends()){theSlots[index]=new Journey(lastSlot.ends(),this.ends())}return theSlots},toString:function(){return this.starts()+"-"+this.ends()},setStartTime:function(a){if(!$defined(a)){return}this.start=this.convertToMinutesDay(a);if(this.start>=this.end){this.start=this.end-this.itsGranularity}},setEndTime:function(a){if(!$defined(a)){return}this.end=this.convertToMinutesDay(a);if(this.end<=this.start){this.end=this.start+this.itsGranularity}}});var Debuggable=new Class({debug:function(a){debugModeON=(document.debugMode==true);debugThisType=($defined(document.debugTypes)&&(document.debugTypes[this.typeName]==true));if(debugModeON||debugThisType){console.log(a)}}});var Delegable=new Class({delegated:undefined,delegate:function(a,b){this.delegated=a;var c=this.getMethodsToDelegate(b);c.each(function(d){this[d]=function(){return this.delegated[d].apply(this.delegated,arguments)}},this)},getMethodsToDelegate:function(e){var a=[];if(!$defined(e)){e=[]}for(var d in this.delegated){var c=typeof(this.delegated[d])=="function";var b=!e.contains(d);if(c&&b){a.push(d)}}return a},});var Bus=new Class({Implements:Debuggable,instanceName:"Bus",subscriptions:[],typeName:"Bus",initialize:function(){var a=($defined(document[this.instanceName]));if(!a){document[this.instanceName]=this}return document[this.instanceName]},subscribe:function(a,b){if(!this.subscriptionExists(a,b)){this.subscriptions.push([a,b])}},subscribers:function(b){var a=[];this.subscriptions.each(function(c){if(c[1]==b){a.push(c[0])}});return a},hasSubscriptions:function(){return this.subscriptions.length>0},subscriptionExists:function(c,e){var a=false;var h=[c,e];for(var b=0;b<this.subscriptions.length;b++){var d=this.subscriptions[b];var g=(d[0]==h[0]);var f=(d[1]==h[1]);if(g&&f){a=true;break}}return a},emit:function(a,b){this.debug("Bus.emit (event, params)");this.debug(a);this.debug(b);this.debug("------------");this.subscribers(a).each(function(c){c.eventDispatch(a,b)})},unsubscribe:function(b,a){a.each(function(c){var d=[b,c];this.removeSubscription(d)},this)},removeSubscription:function(a){this.subscriptions.each(function(b){var d=(b[0]==a[0]);var c=(b[1]==a[1]);if(d&&c){this.subscriptions.erase(b)}},this)},reset:function(){this.subscriptions=[]}});var Service=new Class({name:"ABSTRACT",typeName:"Service",SEPARATOR:"_",executionPrefix:"EXECUTED",lastDataSent:undefined,baseURL:"",execute:function(c,d,b){var a=this.getEventNameForExecution(c);this[c](d,a);if(!$defined(b)||b==false){this.emit(a,d)}},request:function(b,c,a){new Request.JSON({url:b,data:{query:JSON.encode(c)},onComplete:function(d){this.emit(a,d)}.bind(this)}).send();this.lastDataSent=c},emit:function(a,b){this.getBus().emit(a,b)},getEventNameForExecution:function(a){return this.getName()+this.SEPARATOR+a+this.SEPARATOR+this.executionPrefix},getName:function(){return this.name},getLastDataSent:function(){return this.lastDataSent},getBaseURL:function(){return this.baseURL},setBaseURL:function(a){this.baseURL=a},getBus:function(){return new Bus()}});var NullService=new Class({Extends:Service,Implements:Debuggable,typeName:"NullService",name:"NULL",execute:function(b,c,a){this.debug("NullService.execute(procedure, params, asynchronous)");this.debug(b);this.debug(c);this.debug(a);this.debug("------------------------------------------------------")}});var ButtonService=new Class({Extends:Service,name:"BUTTON",typeName:"ButtonService",executionPrefix:"CLICKED",execute:function(b,c){if(!$defined(c)){c={}}c.buttonName=b;var a=this.name+this.SEPARATOR+b+this.SEPARATOR+this.executionPrefix;this.emit(a,c)}});var LabelsService=new Class({Extends:Service,typeName:"LabelsService",name:"LABELS",cache:{},locale:undefined,initialize:function(){if($defined(document.labels)){this.cache=document.labels}this.setLocale(navigator.language||navigator.browserLanguage)},setLocale:function(a){if($defined(a)){this.locale=a;if(!$defined(this.cache[this.locale])){this.cache[this.locale]={}}}},getLabel:function(g,b){var e=b+this.SEPARATOR+g.key;var d=this.fromCache(g.key);if($defined(d)){var a=[];a.answer=d;this.emit(e,a)}else{var f={LABEL_KEY:g.key,LOCALE:this.locale};var c=this.getBaseURL()+"labels/get";this.request(c,f,e)}},fromCache:function(a){return this.cache[this.locale][a]},emit:function(b,d){var a=b.match(/_([a-zA-Z\.]*)$/);var c=null;if($defined(a)){c=a[1]}if(!$defined(c)){return}if(!$defined(d)){d={}}if($defined(d.answer)){this.cache[this.locale][c]=d.answer}else{d.answer=c}this.parent(b,d)}});var Page=new Class({services:{},components:{},initializeServices:function(){},initializeComponents:function(){},cleaners:[],baseURL:"",initialize:function(a){document.page=this;if($defined(a)){this.baseURL=a}this.addService(new LabelsService());this.setUp()},setUp:function(){this.initializeServices();this.initializeComponents()},addService:function(a){a.setBaseURL(this.getBaseURL());this.services[a.getName()]=a},getService:function(b){var a=this.services[b];if(!$defined(a)){a=new NullService()}return a},addComponent:function(b,a,c){this.subcribeComponentEvents(b);b.setName(this.composeName(b,a));this.components[b.getName()]=b;if(c){this.cleaners.push(b.getName())}b.setContainer(a)},subcribeComponentEvents:function(a){var b=a.getManagedEvents();b.each(function(c){(new Bus()).subscribe(a,c)})},draw:function(){$H(this.components).each(function(a){if(this.cleaners.contains(a.getName())){$(a.getContainer()).set("html","")}a.draw()},this)},composeName:function(d,c){var g="_";var e=c+g+d.getTypeName()+g;var b="";var a=1;var h=false;while(!h){var f=e+a;if(!$defined(this.components[f])){h=true;b=f}a++}return b},getComponent:function(b){var a=this.components[b];if(!$defined(a)){a=null}return a},getBaseURL:function(){return this.baseURL}});var Handler=new Class({owner:undefined,typeName:"Handler",dispatch:function(a){this.handle(a)},handle:function(a){},setOwner:function(a){this.owner=a},getOwner:function(){return this.owner},getPage:function(){return document.page}});var SetTextHandler=new Class({Extends:Handler,typeName:"SetTextHandler",Implements:Debuggable,handle:function(b){this.debug("SetTextHandler.handle(params)");this.debug(b);this.debug(this.getOwner());this.debug("----------------------------");if(b){var a=b.answer;this.getOwner().setText(a)}}});var ExecutorHandler=new Class({Extends:Handler,ownerFunction:undefined,typeName:"ExecutorHandler",initialize:function(a){this.ownerFunction=a},handle:function(a){this.getOwner()[this.ownerFunction](a)}});var PrintHandler=new Class({Extends:Handler,typeName:"PrintHandler",handle:function(){window.print()}});var Component=new Class({LABELSERVICENAME:"LABELS",DIVNAMESUFFIX:"_inner",handlers:{},container:undefined,name:"aComponent",innerDivName:undefined,panel:undefined,I18NKey:undefined,SEPARATOR:"_",panelClasses:["innerComponentDiv"],typeName:"Component",text:"",service:"NULL",procedure:"nullProcedure",initialize:function(){this.container=document.body;this.composeInnerDivName()},initializeExecutionContext:function(a,b){if($defined(a)&&$defined(b)){this.service=a;this.procedure=b}},draw:function(){this.panel=new Element("div",{id:this.innerDivName,text:this.text}).inject(this.container);this.setCurrentClasses();this.getLabel()},destroy:function(){$(this.panel).destroy();var a=new Bus();a.unsubscribe(this,this.getManagedEvents())},execute:function(d,e,f,b){var c=($defined(d))?d:this.service;var a=($defined(e))?e:this.procedure;serviceInstance=this.getService(c);if(serviceInstance){serviceInstance.execute(a,f,b)}},eventDispatch:function(a,b){if($defined(this.handlers[a])){this.handlers[a].each(function(c){c.handle(b)})}},addHandler:function(b,a){if(!$defined(this.handlers[b])){this.handlers[b]=[]}a.setOwner(this);this.handlers[b].push(a)},addDispatcher:function(b,a){this.addHandler(b,a)},composeInnerDivName:function(){this.innerDivName=this.name+this.DIVNAMESUFFIX},getText:function(){return this.text},getTypeName:function(){return this.typeName},getName:function(){return this.name},setName:function(a){this.name=a;this.composeInnerDivName()},setContainer:function(a){this.container=a},getContainer:function(){return this.container},getService:function(c){var b=($defined(c))?c:this.service;var a=null;if($defined(document.page)){a=document.page.getService(b)}return a},getLabelService:function(){return this.getService(this.LABELSERVICENAME)},getLabel:function(){if(!$defined(this.I18NKey)){return}var b=this.getLabelService();var a={key:this.I18NKey};if(b){b.execute("getLabel",a,true)}},getUniqueID:function(){return this.innerDivName},getManagedEvents:function(){return $H(this.handlers).getKeys()},setText:function(a){this.text=a;if($defined(this.panel)){this.panel.set("text",a)}},addClass:function(a){this.panelClasses.push(a);if($defined(this.panel)){this.panel.addClass(a)}},removeClass:function(a){this.panelClasses.erase(a);if($defined(this.panel)){this.panel.removeClass(a)}},setCurrentClasses:function(){this.panelClasses.each(function(a){this.panel.addClass(a)},this)},getCurrentClasses:function(){return this.panelClasses},setI18NKey:function(a){if(!$defined(a)){return}this.I18NKey=a;this.addHandler("LABELS_getLabel_EXECUTED_"+a,new SetTextHandler());new Bus().subscribe(this,"LABELS_getLabel_EXECUTED_"+a)},getI18NKey:function(){return this.I18NKey}});var LabelPanel=new Class({Extends:Component,typeName:"LabelPanel",LABELSERVICENAME:"LABELS",initialize:function(a){this.parent();this.setI18NKey(a)},draw:function(){this.parent();this.panel.addClass("labelPanel")}});var Input=new Class({Extends:Component,typeName:"Input",CLASS:"inputJS",label:null,DOMInput:undefined,value:"",disabled:false,type:"text",initialize:function(a,b){this.parent();if($defined(b)){this.type=b}this.setI18NKey(a)},draw:function(){this.parent();this.panel.erase("text");this.label=new Element("label",{text:this.text});this.addClass(this.CLASS);this.DOMInput=new Element("input",{value:this.value,type:this.type}).inject(this.panel);this.DOMInput.set("disabled",this.disabled);this.label.inject(this.panel,"top")},setText:function(a){this.text=a;if($defined(this.label)){this.label.set("text",a)}},getValue:function(){if(!$defined(this.DOMInput)){return this.value}var a=this.DOMInput.get("value");return a},setValue:function(a){this.value=a;if($defined(this.DOMInput)){this.DOMInput.set("value",a)}},disable:function(){this.disabled=true;if($defined(this.DOMInput)){this.DOMInput.set("disabled",this.disabled)}},enable:function(){this.disabled=false;if($defined(this.DOMInput)){this.DOMInput.set("disabled",this.disabled)}}});var Button=new Class({Extends:Component,typeName:"Button",text:"CLICK!",DOMClass:"button",BUTTONSERVICE:"BUTTON",CSSDISABLED:"disabled",data:undefined,procedure:"aButton",service:"BUTTON",buttonName:"aButton",enabled:true,asynchronous:false,initialize:function(a,b){this.parent();this.initializeExecutionContext(this.BUTTONSERVICE,a);this.buttonName=this.procedure;this.setI18NKey(b)},draw:function(){this.classDraw(this.buttonName);this.getLabel()},classDraw:function(b){var c=this.text;if(!$defined(c)){c=b}this.panel=new Element("a",{id:this.getUniqueID(),href:"#"}).inject(this.container);this.panel.addClass(this.DOMClass);this.panel.addClass(this.buttonName);var a=new Element("span").inject(this.panel);a.set("text",c);if(!this.enabled){this.panel.addClass(this.CSSDISABLED)}this.addEvents();this.setCurrentClasses()},click:function(){service=this.getService();if(service){service.execute(this.buttonName,this.data)}},addEvents:function(){if(!this.enabled){return}this.panel.addEvent("click",function(a){if(a){a.stop()}});this.panel.addEvent("click",this.click.bind(this))},disable:function(){this.enabled=false;if($defined(this.panel)){this.panel.removeEvents("click");this.panel.addEvent("click",function(a){if(a){a.stop()}});this.panel.addClass(this.CSSDISABLED)}},enable:function(){this.disable();this.enabled=true;if($defined(this.panel)){this.panel.removeClass(this.CSSDISABLED);this.addEvents()}},setCurrentClasses:function(){this.getCurrentClasses().each(function(a){this.panel.addClass(a)},this)},setText:function(a){this.text=a;if($defined(this.panel)){this.panel.getChildren("span")[0].set("text",a)}},setDOMClass:function(a){this.removeClass(this.DOMClass);this.DOMClass=a;if($defined(this.panel)){this.addClass(a)}},setData:function(a){this.data=a},isEnable:function(){return this.enabled}});var SwitchButton=new Class({Extends:Button,typeName:"SwitchButton",active:true,activeKey:undefined,inactiveKey:undefined,activeLabel:undefined,inactiveLabel:undefined,OFF:"off",ON:"on",initialize:function(a,c,b){this.parent(a);this.activeLabel=this.text;this.inactiveLabel=this.text;this.activeKey=c;this.inactiveKey=b;this.addLabelHandler(this.activeKey,"setActiveLabel");this.addLabelHandler(this.inactiveKey,"setInactiveLabel")},addLabelHandler:function(a,b){this.addHandler("LABELS_getLabel_EXECUTED_"+a,new ExecutorHandler(b));new Bus().subscribe(this,"LABELS_getLabel_EXECUTED_"+a)},draw:function(){var a=this.isActive()?this.activeKey:this.inactiveKey;this.getLabel(this.activeKey);this.getLabel(this.inactiveKey);this.classDraw(a);this.switchClassCSS()},click:function(a){if(a||(!$defined(a))){this.parent()}this.switchState()},switchState:function(){this.active=!this.active;var a=this.isActive()?this.activeLabel:this.inactiveLabel;this.setText(a);this.switchClassCSS()},isActive:function(){return this.active},switchClassCSS:function(){if(!$defined(this.panel)){return}var b=this.OFF;var a=this.ON;if(this.active){b=this.ON;a=this.OFF}this.panel.addClass(b);this.panel.removeClass(a)},getLabel:function(a){if(!$defined(a)){return}var c=this.getLabelService();var b={key:a};if(c){c.execute("getLabel",b,true)}},setActiveLabel:function(a){this.activeLabel=a.answer;this.setText(this.activeLabel)},setInactiveLabel:function(a){this.inactiveLabel=a.answer},getActiveLabel:function(){return this.activeLabel},getInactiveLabel:function(){return this.inactiveLabel},getActiveKey:function(){return this.activeKey},getInactiveKey:function(){return this.inactiveKey}});var NumericSelector=new Class({Extends:Input,Implements:Debuggable,typeName:"NumericSelector",limSup:1e+24,limInf:0,incrementer:1,oldValue:"",draw:function(){this.parent();this.addMinusButton();this.addPlusButton();this.decorateInput();this.setValue(this.getValue())},decorateInput:function(){this.DOMInput.addClass("numericSelector");this.DOMInput.addEvent("focus",this.clearInput.bind(this));this.DOMInput.addEvent("blur",this.restoreInput.bind(this))},addPlusButton:function(){this.plusButton=new Element("a",{href:"#","class":"plusButton",html:"<span>+</span>"}).inject(this.panel);this.plusButton.addEvent("click",function(a){if(a){a.stop()}});this.plusButton.addEvent("click",this.plus.bind(this))},addMinusButton:function(){this.minusButton=new Element("a",{href:"#","class":"minusButton",html:"<span>-</span>"}).inject(this.panel);this.minusButton.addEvent("click",function(a){if(a){a.stop()}});this.minusButton.addEvent("click",this.minus.bind(this))},plus:function(){var a=parseInt(this.getValue())+this.incrementer;this.setValue(a)},minus:function(){var a=this.getValue()-this.incrementer;this.setValue(a)},setValue:function(a){if(a===""){a=this.limInf}if(a==null){a=this.getValue()}value=this.checkLimits(a);snapValue=this.snap(value);this.parent(snapValue);this.checkDecorations();this.notifyChanges()},checkLimits:function(b){var a=b;if(b>=this.limSup){a=this.limSup}if(b<=this.limInf){a=this.limInf}return a},snap:function(b){var a=parseInt(b/this.incrementer)*this.incrementer;return a},checkDecorations:function(){var b=parseInt(this.getValue());var a=$defined(this.DOMInput);if(!a){return}this.plusButton.removeClass("off");this.minusButton.removeClass("off");if((b+this.incrementer)>this.limSup){this.plusButton.addClass("off")}if((b-this.incrementer)<this.limInf){this.minusButton.addClass("off")}},notifyChanges:function(){var a=this.getBus();var b={};b.value=this.getValue().toInt();a.emit("COMPONENT_"+this.name+"_CHANGED",b)},getBus:function(){return new Bus()},setLimSup:function(a){if(a<this.limInf){newlimSup=this.limInf}this.limSup=a;this.setValue(null)},getLimSup:function(){return this.limSup},setLimInf:function(a){if(a>this.limSup){a=this.limSup}this.limInf=a;this.setValue(null)},getLimInf:function(){return this.limInf},setIncrementer:function(a){this.incrementer=a},clearInput:function(){this.oldValue=this.getValue();this.DOMInput.set("value","")},restoreInput:function(){var a=this.getValue();if(this.isIncorrect(a)||!this.isInteger(a)){this.DOMInput.set("value",this.oldValue);a=this.oldvalue}this.setValue(a)},isIncorrect:function(a){trimmedValue=a.replace(/^\s+|\s+$/g,"");noNumber=isNaN(trimmedValue);isEmpty=(trimmedValue=="")||(trimmedValue==null)||(trimmedValue==undefined);return noNumber||isEmpty},isInteger:function(b){var a=parseInt(b);if(isNaN(a)){return false}return(a==b)&&(b.toString()==a.toString())}});var CollapsablePanel=new Class({Extends:Component,typeName:"CollapsablePanel",collapsed:true,originalPaddingTop:undefined,originalPaddingBottom:undefined,COLLAPSED:"collapsed",UNCOLLAPSED:"uncollapsed",initialize:function(a,b){this.parent(a,b);this.addClass("collapsablePanel")},draw:function(){this.panel=new Element("div",{id:this.innerDivName}).inject(this.container);this.originalPaddingTop=this.panel.getStyle("padding-top");this.originalPaddingBottom=this.panel.getStyle("padding-bottom");this.panel.setStyles({height:"0px",overflow:"hidden","padding-top":"0px","padding-bottom":"0px"});this.setCurrentClasses();this.setText(this.getText());if(this.isCollapsed()){this.collapse()}else{this.uncollapse()}},isCollapsed:function(){return this.collapsed},uncollapse:function(){if($defined(this.panel)){this.panel.setStyle("height",this.panel.getScrollSize().y)}this.collapsed=false;this.switchClassCSS()},collapse:function(){if($defined(this.panel)){this.panel.setStyle("height","0px")}this.collapsed=true;this.switchClassCSS()},switchClassCSS:function(){if(!$defined(this.panel)){return}var b=this.COLLAPSED;var a=this.UNCOLLAPSED;if(!this.isCollapsed()){b=this.UNCOLLAPSED;a=this.COLLAPSED;this.panel.setStyle("height","auto")}this.panel.addClass(b);this.panel.removeClass(a)}});var CollapsableDecorator=new Class({Extends:Delegable,myCollapsablePanel:undefined,myFx:undefined,defaultUncollapsingStyles:undefined,defaultCollapsingStyles:undefined,unCollapsingStyles:undefined,collapsingStyles:undefined,excludedDelegatingMethod:["collapse","uncollapse","draw","addHandler"],initialize:function(a){this.myCollapsablePanel=a;this.delegate(this.myCollapsablePanel,this.excludedDelegatingMethod);this.takeOwnershipOfHandlers()},uncollapse:function(){if($defined(this.myCollapsablePanel.panel)){this.myFx.cancel();this.myFx.$events={};this.startUncollapseFx()}this.myCollapsablePanel.uncollapse()},collapse:function(){if($defined(this.myCollapsablePanel.panel)){this.myFx.cancel();this.myFx.$events={};this.startCollapseFx()}this.myCollapsablePanel.collapse()},draw:function(){this.myCollapsablePanel.draw();this.myFx=new Fx.Morph(this.myCollapsablePanel.panel,{transition:"Quint:out"});this.defaultCollapsingStyles={height:"0px","padding-top":"0px","padding-bottom":"0px"};this.defaultUncollapsingStyles={height:this.myCollapsablePanel.panel.getScrollSize().y,"padding-top":this.myCollapsablePanel.panel.originalPaddingTop,"padding-bottom":this.myCollapsablePanel.panel.originalPaddingBottom}},startCollapseFx:function(){if(!$defined(this.collapsingStyles)){this.myFx.start(this.defaultCollapsingStyles)}else{this.myFx.start(this.collapsingStyles)}},startUncollapseFx:function(){if(!$defined(this.unCollapsingStyles)){this.myFx.start(this.defaultUncollapsingStyles)}else{this.myFx.start(this.unCollapsingStyles)}},setUnCollapsingStyles:function(a){this.unCollapsingStyles=a},setCollapsingStyles:function(a){this.collapsingStyles=a},addHandler:function(b,a){this.myCollapsablePanel.addHandler(b,a);a.setOwner(this)},takeOwnershipOfHandlers:function(){if($defined(this.myCollapsablePanel.handlers)){this.myCollapsablePanel.getManagedEvents().each(function(a){this.myCollapsablePanel.handlers[a].each(function(b){this.addHandler(a,b)},this)},this)}}});var SwitchCollapseAndUncollapseHandler=new Class({Extends:Handler,typeName:"SwitchCollapseAndUncollapseHandler",DOMButton:undefined,handle:function(){if(this.owner.isCollapsed()){this.owner.uncollapse();return}this.owner.collapse()}});var TimeRange=new Class({Extends:Component,typeName:"TimeRange",journey:undefined,startHourSelect:null,endHourSelect:null,label:null,initialize:function(a,b){this.parent();this.journey=new Journey();if($defined(b)){this.journey.withGranularityOf(b)}this.setI18NKey(a)},draw:function(){this.parent();this.panel.erase("text");this.addClass("timeRange");this.label=new Element("label",{text:this.text}).inject(this.panel);this.startHourSelect=new Element("select",{"class":"hourSelect startHourSelect"}).inject(this.panel);this.startHourSelect.addEvent("change",function(){var a=this.startHourSelect.get("value");this.setStartHour(a)}.bind(this));this.endHourSelect=new Element("select",{"class":"hourSelect endHourSelect"}).inject(this.panel);this.endHourSelect.addEvent("change",function(){var a=this.endHourSelect.get("value");this.setEndHour(a)}.bind(this));this.setOptions();this.endHourSelect.set("value",this.journey.ends())},setOptions:function(){this.constructStartOptions();this.constructEndOptions()},constructStartOptions:function(){this.clearOptions(this.startHourSelect);slots=this.getSlots("00:00",this.journey.ends());slots.each(function(a){new Element("option",{value:a.starts(),text:a.starts()}).inject(this.startHourSelect)},this)},constructEndOptions:function(){this.clearOptions(this.endHourSelect);slots=this.getSlots(this.journey.starts(),"24:00");slots.each(function(a){new Element("option",{value:a.ends(),text:a.ends()}).inject(this.endHourSelect)},this)},getSlots:function(b,a){aJourney=new Journey(b,a);aJourney.withGranularityOf(this.journey.granularity());return aJourney.slots()},clearOptions:function(b){var a=b.getChildren("option");a.each(function(c){c.destroy()})},setHour:function(b,a){if($defined(b)){this.setOptions();b.set("value",a)}this.emitValues()},setStartHour:function(a){this.journey.setStartTime(a);this.setHour(this.startHourSelect,this.journey.starts());if($defined(this.endHourSelect)){this.endHourSelect.set("value",this.journey.ends())}},setEndHour:function(a){this.journey.setEndTime(a);this.setHour(this.endHourSelect,this.journey.ends());if($defined(this.startHourSelect)){this.startHourSelect.set("value",this.journey.starts())}},setText:function(a){this.text=a;if($defined(this.label)){this.label.set("text",a)}},emitValues:function(){bus=this.getBus();var a={startHour:this.getStartHour(),endHour:this.getEndHour()};bus.emit("COMPONENT_"+this.name+"_CHANGED",a)},getBus:function(){return new Bus()},getStartHour:function(){return this.journey.starts()},getEndHour:function(){return this.journey.ends()}});var NestableComponent=new Class({Extends:Component,hostedComponents:[],host:function(a){this.hostedComponents.push(a)},hosted:function(a){return this.hostedComponents},getManagedEvents:function(){var a=[];a=this.parent();this.hostedComponents.each(function(b){a.combine(b.getManagedEvents())},this);return a},eventDispatch:function(a,b){this.parent(a,b);this.hostedComponents.each(function(c){c.eventDispatch(a,b)})},draw:function(){this.parent();this.hostedComponents.each(function(a){a.setContainer(this.getContainer());a.draw()},this)},destroy:function(){this.hostedComponents.each(function(a){a.destroy()});this.parent()},setName:function(b){this.parent(b);var a=1;this.hostedComponents.each(function(c){c.setName(this.getName()+this.SEPARATOR+c.getName()+this.SEPARATOR+a);a++},this)},});